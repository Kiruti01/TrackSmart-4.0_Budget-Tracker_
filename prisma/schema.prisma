generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserSettings {
  userId   String @id
  currency String
}

model Category {
  createdAt DateTime @default(now())
  name      String
  userId    String
  icon      String
  type      String @default("income")

  @@unique([name, userId, type])
}

model Transaction {
  id               String   @id @default(uuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now())
  amount           Float
  description      String
  date             DateTime
  userId           String
  type             String   @default("income")
  category         String
  categoryIcon     String
  originalAmount   Float    @default(0)
  originalCurrency String   @default("USD")
}

model MonthHistory {
  userId     String
  day        Int
  month      Int
  year       Int
  income     Float
  expense    Float
  savings    Float
  investment Float @default(0)

  @@id([userId, day, month, year])
}

model YearHistory {
  userId     String
  month      Int
  year       Int
  income     Float
  expense    Float
  savings    Float
  investment Float @default(0)

  @@id([month, year, userId])
}

model CumulativeSavings {
  userId       String   @id
  totalSavings Float    @default(0)
  updatedAt    DateTime @updatedAt
}

model InvestmentCategory {
  id              String       @id @default(uuid())
  userId          String?      @map("user_id")
  name            String
  icon            String       @default("üìù")
  isSystemDefault Boolean      @default(false) @map("is_system_default")
  createdAt       DateTime     @default(now()) @map("created_at")
  investments     Investment[]

  @@map("investment_categories")
}

model Investment {
  id                    String             @id @default(uuid())
  userId                String             @map("user_id")
  name                  String
  categoryId            String             @map("category_id")
  currency              String             @default("KES")
  initialAmount         Float              @map("initial_amount")
  initialExchangeRate   Float              @default(1.0) @map("initial_exchange_rate")
  initialAmountKes      Float              @map("initial_amount_kes")
  currentAmount         Float              @map("current_amount")
  currentExchangeRate   Float              @default(1.0) @map("current_exchange_rate")
  currentValueKes       Float              @map("current_value_kes")
  totalInvested         Float              @map("total_invested")
  dateInvested          DateTime           @map("date_invested") @db.Date
  lastUpdated           DateTime           @default(now()) @map("last_updated")
  notes                 String?
  createdAt             DateTime           @default(now()) @map("created_at")
  category              InvestmentCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  updates               InvestmentUpdate[]

  @@index([userId])
  @@index([categoryId])
  @@index([dateInvested])
  @@map("investments")
}

model InvestmentUpdate {
  id                       String     @id @default(uuid())
  investmentId             String     @map("investment_id")
  updateType               String     @map("update_type")
  previousAmount           Float      @map("previous_amount")
  newAmount                Float      @map("new_amount")
  previousExchangeRate     Float      @map("previous_exchange_rate")
  newExchangeRate          Float      @map("new_exchange_rate")
  previousValueKes         Float      @map("previous_value_kes")
  newValueKes              Float      @map("new_value_kes")
  additionalCapital        Float?     @map("additional_capital")
  gainLossCurrency         Float      @map("gain_loss_currency")
  gainLossKes              Float      @map("gain_loss_kes")
  percentageChangeCurrency Float      @map("percentage_change_currency")
  percentageChangeKes      Float      @map("percentage_change_kes")
  updateDate               DateTime   @map("update_date") @db.Date
  notes                    String?
  createdAt                DateTime   @default(now()) @map("created_at")
  investment               Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  @@index([investmentId])
  @@index([updateDate])
  @@map("investment_updates")
}