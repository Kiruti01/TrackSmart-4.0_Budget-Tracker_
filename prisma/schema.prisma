generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model UserSettings {
  userId   String @id
  currency String
}

model Category {
  createdAt DateTime @default(now())
  name      String
  userId    String
  icon      String
  type      String @default("income")

  @@unique([name, userId, type])
}

model Transaction {
  id               String   @id @default(uuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now())
  amount           Float
  description      String
  date             DateTime
  userId           String
  type             String   @default("income")
  category         String
  categoryIcon     String
  originalAmount   Float    @default(0)
  originalCurrency String   @default("USD")
}

model MonthHistory {
  userId     String
  day        Int
  month      Int
  year       Int
  income     Float
  expense    Float
  savings    Float
  investment Float @default(0)

  @@id([userId, day, month, year])
}

model YearHistory {
  userId     String
  month      Int
  year       Int
  income     Float
  expense    Float
  savings    Float
  investment Float @default(0)

  @@id([month, year, userId])
}

model CumulativeSavings {
  userId       String   @id
  totalSavings Float    @default(0)
  updatedAt    DateTime @updatedAt
}

model InvestmentCategory {
  id              String       @id @default(uuid())
  userId          String?
  name            String
  icon            String       @default("üìù")
  isSystemDefault Boolean      @default(false)
  createdAt       DateTime     @default(now())
  investments     Investment[]

  @@map("investment_categories")
}

model Investment {
  id                    String             @id @default(uuid())
  userId                String
  name                  String
  categoryId            String
  currency              String             @default("KES")
  initialAmount         Float
  initialExchangeRate   Float              @default(1.0)
  initialAmountKes      Float
  currentAmount         Float
  currentExchangeRate   Float              @default(1.0)
  currentValueKes       Float
  totalInvested         Float
  dateInvested          DateTime
  lastUpdated           DateTime           @default(now())
  notes                 String?
  createdAt             DateTime           @default(now())
  category              InvestmentCategory @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  updates               InvestmentUpdate[]

  @@index([userId])
  @@index([categoryId])
  @@index([dateInvested])
  @@map("investments")
}

model InvestmentUpdate {
  id                       String     @id @default(uuid())
  investmentId             String
  updateType               String
  previousAmount           Float
  newAmount                Float
  previousExchangeRate     Float
  newExchangeRate          Float
  previousValueKes         Float
  newValueKes              Float
  additionalCapital        Float?
  gainLossCurrency         Float
  gainLossKes              Float
  percentageChangeCurrency Float
  percentageChangeKes      Float
  updateDate               DateTime
  notes                    String?
  createdAt                DateTime   @default(now())
  investment               Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  @@index([investmentId])
  @@index([updateDate])
  @@map("investment_updates")
}